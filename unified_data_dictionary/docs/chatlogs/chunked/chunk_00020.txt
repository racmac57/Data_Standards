Updating the queries accordingly:



Updating both queries to handle Excel serial date numbers and target the correct month:


```objective-c
// ___Top_5_Arrests
// ğŸ•’ 2025-01-05-14-30-00
// Project: Arrest_Analysis/Top_5_Arrest
// Author: R. A. Carucci
// Purpose: Fixed Top 5 Officers analysis with dynamic file loading and better error handling

let
    // â•â•â• A) Dynamic file discovery â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    FolderFiles = Folder.Files("C:\Users\carucci_r\OneDrive - City of Hackensack\01_DataSources\ARREST_DATA\Power_BI"),
    
    PowerBIFiles = Table.SelectRows(
        FolderFiles,
        each [Extension] = ".xlsx" and Text.Contains([Name], "PowerBI_Ready")
    ),
    
    Sorted = Table.Sort(PowerBIFiles, {{"Date modified", Order.Descending}}),

    // Load the latest file
    Source = if Table.RowCount(Sorted) > 0 then
        let
            LatestFile = Sorted{0}[Content],
            ExcelData = Excel.Workbook(LatestFile, null, true),
            FirstSheet = ExcelData{0}[Data]
        in
            FirstSheet
    else
        error "No Power BI ready files found",

    // â•â•â• B) Promote headers and handle column names â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Headers = Table.PromoteHeaders(Source, [PromoteAllScalars = true]),

    // Check if columns exist and rename safely
    SafeRename = if Table.HasColumns(Headers, "Officer of Record") then
        Table.RenameColumns(Headers, {{"Officer of Record", "OfficerOfRecord"}})
    else if Table.HasColumns(Headers, "Officer_of_Record") then
        Table.RenameColumns(Headers, {{"Officer_of_Record", "OfficerOfRecord"}})
    else if Table.HasColumns(Headers, "OfficerOfRecord") then
        Headers
    else
        error "Officer column not found in data",

    SafeRename2 = if Table.HasColumns(SafeRename, "Arrest Date") then
        Table.RenameColumns(SafeRename, {{"Arrest Date", "ArrestDate"}})
    else if Table.HasColumns(SafeRename, "Arrest_Date") then
        Table.RenameColumns(SafeRename, {{"Arrest_Date", "ArrestDate"}})
    else if Table.HasColumns(SafeRename, "ArrestDate") then
        SafeRename
    else
        error "Arrest Date column not found in data",

    // â•â•â• C) Calculate previous month with better date handling â•â•â•â•
    Current = Date.From(DateTime.LocalNow()),
    PreviousMonth = Date.AddMonths(Current, -1),
    TargetYear = Date.Year(PreviousMonth),
    TargetMonth = Date.Month(PreviousMonth),
    MonthYearDisplay = Date.MonthName(PreviousMonth) & " " & Text.From(TargetYear),

    // â•â•â• D) Filter to previous month with better error handling â•â•â•
    // Handle Excel serial dates, actual dates, and text dates
    ToDate = (x) => 
        if x = null or x = "" then
            null
        else
            // Try Date.From first (handles Excel serial numbers and dates)
            try Date.From(x) otherwise
            // Try converting number to Excel serial date
            try if Number.From(x) > 0 and Number.From(x) < 1000000 then
                Date.From(Number.From(x))
            else
                null
            otherwise
            // Try Date.FromText for text dates
            try Date.FromText(Text.From(x)) otherwise null,

    PreviousMonthOnly = Table.SelectRows(
        SafeRename2,
        each let d = ToDate([ArrestDate]) in d <> null and Date.Year(d) = TargetYear and Date.Month(d) = TargetMonth
    ),

    // â•â•â• E) Handle empty results gracefully â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    HasData = Table.RowCount(PreviousMonthOnly) > 0,

    VerifyData = if not HasData then
        #table({"OfficerOfRecord", "ArrestDate", "Officer_Name_Clean", "Arrest_Count", "Month_Year", "Rank", "Source_File"}, {})
    else
        PreviousMonthOnly,

    // â•â•â• F) Clean officer names with simplified logic â•â•â•â•â•â•â•â•â•â•â•â•â•
    CleanOfficerNames = if not HasData then
        VerifyData
    else
        Table.TransformColumns(
            VerifyData,
            {{"OfficerOfRecord", each
                if _ = null or _ = "" then
                    "UNKNOWN OFFICER"
                else
                    let
                        original = Text.Upper(Text.Trim(Text.From(_))),
                        // Remove common prefixes
                        step1 = Text.Replace(
                            Text.Replace(
                                Text.Replace(
                                    Text.Replace(original, "P.O. ", ""),
                                    "PO ", ""
                                ),
                                "DET. ", ""
                            ),
                            "DETECTIVE ", ""
                        ),
                        // Clean up whitespace and special characters
                        step2 = Text.Replace(
                            Text.Replace(
                                Text.Replace(
                                    Text.Replace(
                                        Text.Replace(step1, "  ", " "),
                                        " - ", " "
                                    ),
                                    "(", ""
                                ),
                                ")", ""
                            ),
                            "#", ""
                        ),
                        // Simple badge number removal - remove trailing 1-4 digit numbers
                        step3 = Text.Trim(
                            if Text.Length(step2) > 0 then
                                let
                                    words = Text.Split(step2, " "),
                                    lastWord = if List.Count(words) > 1 then List.Last(words) else "",
                                    isNumber = try Number.From(lastWord) >= 0 otherwise false,
                                    isBadgeNumber = Text.Length(lastWord) <= 4 and isNumber,
                                    cleanWords = if isBadgeNumber then List.RemoveLastN(words, 1) else words
                                in
                                    Text.Combine(cleanWords, " ")
                            else
                                step2
                        )
                    in
                        if Text.Length(step3) > 0 then step3 else "UNKNOWN OFFICER",
                type text
            }}
        ),

    // â•â•â• G) Group by officer and count arrests â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    GroupedByOfficer = if not HasData then
        #table({"OfficerOfRecord", "Arrest_Count"}, {})
    else
        Table.Group(
            CleanOfficerNames,
            {"OfficerOfRecord"},
            {{"Arrest_Count", each Table.RowCount(_), Int64.Type}}
        ),

    // â•â•â• H) Sort and get top 5 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    SortedByCount = if not HasData then
        GroupedByOfficer
    else
        Table.Sort(GroupedByOfficer, {{"Arrest_Count", Order.Descending}}),

    Top5Officers = if not HasData then
        GroupedByOfficer
    else
        Table.FirstN(SortedByCount, 5),

    // â•â•â• I) Add metadata and formatting â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WithMonthYear = Table.AddColumn(Top5Officers, "Month_Year", each MonthYearDisplay, type text),

    WithRanking = Table.AddIndexColumn(WithMonthYear, "Rank", 1, 1, Int64.Type),

    // Rename for final output
    FinalRenamed = Table.RenameColumns(WithRanking, {{"OfficerOfRecord", "Officer_Name_Clean"}}),

    // â•â•â• J) Final type enforcement â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    TypedData = Table.TransformColumnTypes(
        FinalRenamed,
        {
            {"Officer_Name_Clean", type text},
            {"Arrest_Count", Int64.Type},
            {"Month_Year", type text},
            {"Rank", Int64.Type}
        }
    ),

    // â•â•â• K) Add source file info for debugging â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WithSourceInfo = if Table.RowCount(Sorted) > 0 then
        Table.AddColumn(TypedData, "Source_File", each Sorted{0}[Name], type text)
    else
        TypedData

in
    WithSourceInfo

```

```objective-c
// ___Arrest_Categories
// ğŸ•’ 2025-01-05-14-30-00
// Project: Arrest_Analysis/Arrest_Categories
// Author: R. A. Carucci
// Purpose: Simplified M Code that relies on Python preprocessing for geographic data

let
    // â•â•â• A) Load latest Power BI ready file â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    FolderFiles = Folder.Files("C:\Users\carucci_r\OneDrive - City of Hackensack\01_DataSources\ARREST_DATA\Power_BI"),
    
    PowerBIFiles = Table.SelectRows(
        FolderFiles,
        each [Extension] = ".xlsx" and Text.Contains([Name], "PowerBI_Ready")
    ),
    
    Sorted = Table.Sort(PowerBIFiles, {{"Date modified", Order.Descending}}),
    
    // Load the latest file
    Source = if Table.RowCount(Sorted) > 0 then
        Excel.Workbook(Sorted{0}[Content], null, true){0}[Data]
    else
        error "No Power BI ready files found",

    // â•â•â• B) Basic data cleaning â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Headers = Table.PromoteHeaders(Source, [PromoteAllScalars = true]),
    
    // Filter to previous month - handle multiple date column name variations
    // Handle Excel serial dates, actual dates, and text dates
    ToDate = (x) => 
        if x = null or x = "" then
            null
        else
            // Try Date.From first (handles Excel serial numbers and dates)
            try Date.From(x) otherwise
            // Try converting number to Excel serial date
            try if Number.From(x) > 0 and Number.From(x) < 1000000 then
                Date.From(Number.From(x))
            else
                null
            otherwise
            // Try Date.FromText for text dates
            try Date.FromText(Text.From(x)) otherwise null,
    
    Prev = Date.AddMonths(Date.From(DateTime.LocalNow()), -1),
    PrevY = Date.Year(Prev),
    PrevM = Date.Month(Prev),
    
    // Find the date column (handle variations)
    DateColumnName = if Table.HasColumns(Headers, "Arrest Date") then
        "Arrest Date"
    else if Table.HasColumns(Headers, "Arrest_Date") then
        "Arrest_Date"
    else if Table.HasColumns(Headers, "ArrestDate") then
        "ArrestDate"
    else if Table.HasColumns(Headers, "Date") then
        "Date"
    else
        null,
    
    DateFiltered = if DateColumnName = null then
        #table({"Name", "Age", "Address", "Charge", "Arrest Date"}, {})
    else
        Table.SelectRows(
            Headers,
            each let d = ToDate(Record.Field(_, DateColumnName)) in d <> null and Date.Year(d) = PrevY and Date.Month(d) = PrevM
        ),

    // â•â•â• C) Handle empty results gracefully â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    HasData = Table.RowCount(DateFiltered) > 0,
    
    // Use Python-processed geographic data directly
    WithHomeCategory = if not HasData then
        #table({"Name", "Age", "Address", "Charge", "Arrest Date", "Home_Category_Final"}, {})
    else
        Table.AddColumn(
            DateFiltered,
            "Home_Category_Final",
            each
                // Use Python's Home_Category if available, otherwise fallback
                if Table.HasColumns(DateFiltered, "Home_Category") then
                    [Home_Category]
                else if Text.Contains(Text.Upper([Address] ? ? ""), "HACKENSACK") then
                    "Local"
                else
                    "Check Data",
            type text
        ),

    // â•â•â• D) Simple charge categorization â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    AddChargeCategory = if not HasData then
        WithHomeCategory
    else
        Table.AddColumn(
            WithHomeCategory,
            "ChargeCategory",
            each
                let charge = Text.Upper([Charge] ? ? "") in
                if Text.Contains(charge, "ASSAULT") then "Assault"
                else if Text.Contains(charge, "SHOPLIFTING") then "Theft"
                else if Text.Contains(charge, "BURGLARY") then "Burglary"
                else if Text.Contains(charge, "ROBBERY") then "Robbery"
                else if Text.Contains(charge, "WARRANT") then "Warrant"
                else if Text.Contains(charge, "DWI") then "DWI"
                else if Text.Contains(charge, "DRUG") then "Drug Related"
                else if Text.Contains(charge, "WEAPON") then "Weapons"
                else "Other",
            type text
        ),

    // â•â•â• E) Data quality indicators â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    AddDataQuality = if not HasData then
        Table.AddColumn(AddChargeCategory, "DataQualityScore", each 0, type number)
    else if Table.HasColumns(AddChargeCategory, "DataQualityScore") then
        AddChargeCategory
    else
        Table.AddColumn(
            AddChargeCategory,
            "DataQualityScore",
            each
                (if [Name] <> null and [Name] <> "" then 1 else 0) +
                (if [Age] <> null and Number.From([Age] ? ? 0) > 0 then 1 else 0) +
                (if [Address] <> null and [Address] <> "" then 1 else 0) +
                (if [Charge] <> null and [Charge] <> "" then 1 else 0) +
                (if Table.HasColumns(AddChargeCategory, "ZIP") and [ZIP] <> null then 1 else 0),
            type number
        ),

    // â•â•â• F) Final type enforcement â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    TypedData = if not HasData then
        AddDataQuality
    else
        Table.TransformColumnTypes(
            AddDataQuality,
            {
                {"Age", type number},
                {"DataQualityScore", type number},
                {DateColumnName, type date}
            },
            MissingField.Ignore
        ),

    // â•â•â• G) Add source tracking â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WithSourceInfo = Table.AddColumn(
        TypedData,
        "SourceFile",
        each if Table.RowCount(Sorted) > 0 then Sorted{0}[Name] else "Unknown",
        type text
    )

in
    WithSourceInfo

```


Data is from November 2025, but the query targets December 2025. Updating the queries to target November 2025 (or the most recent month in the data):


```objective-c
// ___Top_5_Arrests
// ğŸ•’ 2025-01-05-14-30-00
// Project: Arrest_Analysis/Top_5_Arrest
// Author: R. A. Carucci
// Purpose: Fixed Top 5 Officers analysis with dynamic file loading and better error handling

let
    // â•â•â• A) Dynamic file discovery â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    FolderFiles = Folder.Files("C:\Users\carucci_r\OneDrive - City of Hackensack\01_DataSources\ARREST_DATA\Power_BI"),
    
    PowerBIFiles = Table.SelectRows(
        FolderFiles,
        each [Extension] = ".xlsx" and Text.Contains([Name], "PowerBI_Ready")
    ),
    
    Sorted = Table.Sort(PowerBIFiles, {{"Date modified", Order.Descending}}),

    // Load the latest file
    Source = if Table.RowCount(Sorted) > 0 then
        let
            LatestFile = Sorted{0}[Content],
            ExcelData = Excel.Workbook(LatestFile, null, true),
            FirstSheet = ExcelData{0}[Data]
        in
            FirstSheet
    else
        error "No Power BI ready files found",

    // â•â•â• B) Promote headers and handle column names â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Headers = Table.PromoteHeaders(Source, [PromoteAllScalars = true]),

    // Check if columns exist and rename safely
    SafeRename = if Table.HasColumns(Headers, "Officer of Record") then
        Table.RenameColumns(Headers, {{"Officer of Record", "OfficerOfRecord"}})
    else if Table.HasColumns(Headers, "Officer_of_Record") then
        Table.RenameColumns(Headers, {{"Officer_of_Record", "OfficerOfRecord"}})
    else if Table.HasColumns(Headers, "OfficerOfRecord") then
        Headers
    else
        error "Officer column not found in data",

    SafeRename2 = if Table.HasColumns(SafeRename, "Arrest Date") then
        Table.RenameColumns(SafeRename, {{"Arrest Date", "ArrestDate"}})
    else if Table.HasColumns(SafeRename, "Arrest_Date") then
        Table.RenameColumns(SafeRename, {{"Arrest_Date", "ArrestDate"}})
    else if Table.HasColumns(SafeRename, "ArrestDate") then
        SafeRename
    else
        error "Arrest Date column not found in data",

    // â•â•â• C) Calculate target month - use November 2025 (most recent data available)
    // Note: File is 2025_11_Arrests_PowerBI_Ready.xlsx, so data is November 2025
    // When December 2025 data becomes available, change this back to previous month logic
    Current = Date.From(DateTime.LocalNow()),
    // Use November 2025 as target (most recent data in file)
    TargetYear = 2025,
    TargetMonth = 11,
    MonthYearDisplay = "November 2025",
    
    // Alternative: Uncomment below to use previous month logic when December data is available
    // PreviousMonth = Date.AddMonths(Current, -1),
    // TargetYear = Date.Year(PreviousMonth),
    // TargetMonth = Date.Month(PreviousMonth),
    // MonthYearDisplay = Date.MonthName(PreviousMonth) & " " & Text.From(TargetYear),

    // â•â•â• D) Filter to previous month with better error handling â•â•â•
    // Handle Excel serial dates, actual dates, and text dates
    ToDate = (x) => 
        if x = null or x = "" then
            null
        else
            // Try Date.From first (handles Excel serial numbers and dates)
            try Date.From(x) otherwise
            // Try converting number to Excel serial date
            try if Number.From(x) > 0 and Number.From(x) < 1000000 then
                Date.From(Number.From(x))
            else
                null
            otherwise
            // Try Date.FromText for text dates
            try Date.FromText(Text.From(x)) otherwise null,

    PreviousMonthOnly = Table.SelectRows(
        SafeRename2,
        each let d = ToDate([ArrestDate]) in d <> null and Date.Year(d) = TargetYear and Date.Month(d) = TargetMonth
    ),

    // â•â•â• E) Handle empty results gracefully â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    HasData = Table.RowCount(PreviousMonthOnly) > 0,

    VerifyData = if not HasData then
        #table({"OfficerOfRecord", "ArrestDate", "Officer_Name_Clean", "Arrest_Count", "Month_Year", "Rank", "Source_File"}, {})
    else
        PreviousMonthOnly,

    // â•â•â• F) Clean officer names with simplified logic â•â•â•â•â•â•â•â•â•â•â•â•â•
    CleanOfficerNames = if not HasData then
        VerifyData
    else
        Table.TransformColumns(
            VerifyData,
            {{"OfficerOfRecord", each
                if _ = null or _ = "" then
                    "UNKNOWN OFFICER"
                else
                    let
                        original = Text.Upper(Text.Trim(Text.From(_))),
                        // Remove common prefixes
                        step1 = Text.Replace(
                            Text.Replace(
                                Text.Replace(
                                    Text.Replace(original, "P.O. ", ""),
                                    "PO ", ""
                                ),
                                "DET. ", ""
                            ),
                            "DETECTIVE ", ""
                        ),
                        // Clean up whitespace and special characters
                        step2 = Text.Replace(
                            Text.Replace(
                                Text.Replace(
                                    Text.Replace(
                                        Text.Replace(step1, "  ", " "),
                                        " - ", " "
                                    ),
                                    "(", ""
                                ),
                                ")", ""
                            ),
                            "#", ""
                        ),
                        // Simple badge number removal - remove trailing 1-4 digit numbers
                        step3 = Text.Trim(
                            if Text.Length(step2) > 0 then
                                let
                                    words = Text.Split(step2, " "),
                                    lastWord = if List.Count(words) > 1 then List.Last(words) else "",
                                    isNumber = try Number.From(lastWord) >= 0 otherwise false,
                                    isBadgeNumber = Text.Length(lastWord) <= 4 and isNumber,
                                    cleanWords = if isBadgeNumber then List.RemoveLastN(words, 1) else words
                                in
                                    Text.Combine(cleanWords, " ")
                            else
                                step2
                        )
                    in
                        if Text.Length(step3) > 0 then step3 else "UNKNOWN OFFICER",
                type text
            }}
        ),

    // â•â•â• G) Group by officer and count arrests â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    GroupedByOfficer = if not HasData then
        #table({"OfficerOfRecord", "Arrest_Count"}, {})
    else
        Table.Group(
            CleanOfficerNames,
            {"OfficerOfRecord"},
            {{"Arrest_Count", each Table.RowCount(_), Int64.Type}}
        ),

    // â•â•â• H) Sort and get top 5 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    SortedByCount = if not HasData then
        GroupedByOfficer
    else
        Table.Sort(GroupedByOfficer, {{"Arrest_Count", Order.Descending}}),

    Top5Officers = if not HasData then
        GroupedByOfficer
    else
        Table.FirstN(SortedByCount, 5),

    // â•â•â• I) Add metadata and formatting â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WithMonthYear = Table.AddColumn(Top5Officers, "Month_Year", each MonthYearDisplay, type text),

    WithRanking = Table.AddIndexColumn(WithMonthYear, "Rank", 1, 1, Int64.Type),

    // Rename for final output
    FinalRenamed = Table.RenameColumns(WithRanking, {{"OfficerOfRecord", "Officer_Name_Clean"}}),

    // â•â•â• J) Final type enforcement â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    TypedData = Table.TransformColumnTypes(
        FinalRenamed,
        {
            {"Officer_Name_Clean", type text},
            {"Arrest_Count", Int64.Type},
            {"Month_Year", type text},
            {"Rank", Int64.Type}
        }
    ),

    // â•â•â• K) Add source file info for debugging â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WithSourceInfo = if Table.RowCount(Sorted) > 0 then
        Table.AddColumn(TypedData, "Source_File", each Sorted{0}[Name], type text)
    else
        TypedData

in
    WithSourceInfo

```

```objective-c
// ___Arrest_Categories
// ğŸ•’ 2025-01-05-14-30-00
// Project: Arrest_Analysis/Arrest_Categories
// Author: R. A. Carucci
// Purpose: Simplified M Code that relies on Python preprocessing for geographic data

let
    // â•â•â• A) Load latest Power BI ready file â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    FolderFiles = Folder.Files("C:\Users\carucci_r\OneDrive - City of Hackensack\01_DataSources\ARREST_DATA\Power_BI"),
    
    PowerBIFiles = Table.SelectRows(
        FolderFiles,
        each [Extension] = ".xlsx" and Text.Contains([Name], "PowerBI_Ready")
    ),
    
    Sorted = Table.Sort(PowerBIFiles, {{"Date modified", Order.Descending}}),
    
    // Load the latest file
    Source = if Table.RowCount(Sorted) > 0 then
        Excel.Workbook(Sorted{0}[Content], null, true){0}[Data]
    else
        error "No Power BI ready files found",

    // â•â•â• B) Basic data cleaning â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Headers = Table.PromoteHeaders(Source, [PromoteAllScalars = true]),
    
    // Filter to previous month - handle multiple date column name variations
    // Handle Excel serial dates, actual dates, and text dates
    ToDate = (x) => 
        if x = null or x = "" then
            null
        else
            // Try Date.From first (handles Excel serial numbers and dates)
            try Date.From(x) otherwise
            // Try converting number to Excel serial date
            try if Number.From(x) > 0 and Number.From(x) < 1000000 then
                Date.From(Number.From(x))
            else
                null
            otherwise
            // Try Date.FromText for text dates
            try Date.FromText(Text.From(x)) otherwise null,
    
    // Use November 2025 as target (most recent data in file)
    // Note: File is 2025_11_Arrests_PowerBI_Ready.xlsx, so data is November 2025
    // When December 2025 data becomes available, change this back to previous month logic
    PrevY = 2025,
    PrevM = 11,
    
    // Alternative: Uncomment below to use previous month logic when December data is available
    // Prev = Date.AddMonths(Date.From(DateTime.LocalNow()), -1),
    // PrevY = Date.Year(Prev),
    // PrevM = Date.Month(Prev),
    
    // Find the date column (handle variations)
    DateColumnName = if Table.HasColumns(Headers, "Arrest Date") then
        "Arrest Date"
    else if Table.HasColumns(Headers, "Arrest_Date") then
        "Arrest_Date"
    else if Table.HasColumns(Headers, "ArrestDate") then
        "ArrestDate"
    else if Table.HasColumns(Headers, "Date") then
        "Date"
    else
        null,
    
    DateFiltered = if DateColumnName = null then
        #table({"Name", "Age", "Address", "Charge", "Arrest Date"}, {})
    else
        Table.SelectRows(
            Headers,
            each let d = ToDate(Record.Field(_, DateColumnName)) in d <> null and Date.Year(d) = PrevY and Date.Month(d) = PrevM
        ),

    // â•â•â• C) Handle empty results gracefully â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    HasData = Table.RowCount(DateFiltered) > 0,
    
    // Use Python-processed geographic data directly
    WithHomeCategory = if not HasData then
        #table({"Name", "Age", "Address", "Charge", "Arrest Date", "Home_Category_Final"}, {})
    else
        Table.AddColumn(
            DateFiltered,
            "Home_Category_Final",
            each
                // Use Python's Home_Category if available, otherwise fallback
                if Table.HasColumns(DateFiltered, "Home_Category") then
                    [Home_Category]
                else if Text.Contains(Text.Upper([Address] ? ? ""), "HACKENSACK") then
                    "Local"
                else
                    "Check Data",
            type text
        ),

    // â•â•â• D) Simple charge categorization â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    AddChargeCategory = if not HasData then
        WithHomeCategory
    else
        Table.AddColumn(
            WithHomeCategory,
            "ChargeCategory",
            each
                let charge = Text.Upper([Charge] ? ? "") in
                if Text.Contains(charge, "ASSAULT") then "Assault"
                else if Text.Contains(charge, "SHOPLIFTING") then "Theft"
                else if Text.Contains(charge, "BURGLARY") then "Burglary"
                else if Text.Contains(charge, "ROBBERY") then "Robbery"
                else if Text.Contains(charge, "WARRANT") then "Warrant"
                else if Text.Contains(charge, "DWI") then "DWI"
                else if Text.Contains(charge, "DRUG") then "Drug Related"
                else if Text.Contains(charge, "WEAPON") then "Weapons"
                else "Other",
            type text
        ),

    // â•â•â• E) Data quality indicators â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    AddDataQuality = if not HasData then
        Table.AddColumn(AddChargeCategory, "DataQualityScore", each 0, type number)
    else if Table.HasColumns(AddChargeCategory, "DataQualityScore") then
        AddChargeCategory
    else
        Table.AddColumn(
            AddChargeCategory,
            "DataQualityScore",
            each
                (if [Name] <> null and [Name] <> "" then 1 else 0) +
                (if [Age] <> null and Number.From([Age] ? ? 0) > 0 then 1 else 0) +
                (if [Address] <> null and [Address] <> "" then 1 else 0) +
                (if [Charge] <> null and [Charge] <> "" then 1 else 0) +
                (if Table.HasColumns(AddChargeCategory, "ZIP") and [ZIP] <> null then 1 else 0),
            type number
        ),

    // â•â•â• F) Final type enforcement â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    TypedData = if not HasData then
        AddDataQuality
    else
        Table.TransformColumnTypes(
            AddDataQuality,
            {
                {"Age", type number},
                {"DataQualityScore", type number},
                {DateColumnName, type date}
            },
            MissingField.Ignore
        ),

    // â•â•â• G) Add source tracking â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    WithSourceInfo = Table.AddColumn(
        TypedData,
        "SourceFile",
        each if Table.RowCount(Sorted) > 0 then Sorted{0}[Name] else "Unknown",
        type text
    )

in
    WithSourceInfo

```

```markdown
# Arrest Queries Fix Summary - January 5, 2026

## ğŸ” Root Cause Identified

### Problem
- Queries were loading successfully but returning **0 rows**
- Diagnostic query showed: **"Rows After Date Filter: 0"**

### Root Cause
1. **Date Format Issue:** The "Arrest Date" column contains **Excel serial numbers** (45962, 45963, etc.) instead of actual dates
2. **Month Mismatch:** 
   - Query was targeting **December 2025** (previous month from January 2026)
   - Data file contains **November 2025** arrests only
   - File name: `2025_11_Arrests_PowerBI_Ready.xlsx`

### Evidence from Raw Data
- All rows show `MonthProcessed: "November 2025"`
- All rows show `DateFilterRange: "2025-11-01 to 2025-11-30"`
- "Arrest Date" values are Excel serial numbers: 45962, 45963, 45964, etc. - Excel serial 45962 = November 1, 2025

---

## âœ… Fixes Applied

### 1. Enhanced Date Parsing Function

**Updated `ToDate` function** in both queries to handle:
- âœ… Excel serial numbers (45962, 45963, etc.) - âœ… Actual date values
- âœ… Text date strings

**Before:**
```m
ToDate = (x) => try Date.From(x) otherwise null,
```

**After:**
```m
ToDate = (x) => 
    if x = null or x = "" then
        null
    else
        // Try Date.From first (handles Excel serial numbers and dates)
        try Date.From(x) otherwise
        // Try converting number to Excel serial date
        try if Number.From(x) > 0 and Number.From(x) < 1000000 then
            Date.From(Number.From(x))
        else
            null
        otherwise
        // Try Date.FromText for text dates
        try Date.FromText(Text.From(x)) otherwise null,
```

### 2.