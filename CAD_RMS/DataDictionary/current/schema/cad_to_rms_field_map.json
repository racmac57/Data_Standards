{
  "schema_version": "2.0",
  "generated_on": "2025-12-30",
  "direction": "cad_to_rms",
  "description": "Enhanced CAD-to-RMS mapping with multi-column matching support",
  "join_keys": {
    "primary": {
      "cad_internal_field_name": "ReportNumberNew",
      "cad_source_field_name": "ReportNumberNew",
      "rms_internal_field_name": "CaseNumber",
      "rms_source_field_name": "Case Number",
      "key_normalization": {
        "trim": true,
        "collapse_internal_whitespace": true,
        "remove_nonprinting": true,
        "case_sensitive": false,
        "uppercase": false
      }
    },
    "alternative_matching_strategies": [
      {
        "strategy_name": "temporal_address_match",
        "description": "Match on incident date/time plus address when primary key fails",
        "confidence_threshold": 0.85,
        "required_fields": {
          "cad": ["TimeofCall", "FullAddress2"],
          "rms": ["IncidentDate", "IncidentTime", "FullAddress"]
        },
        "matching_rules": [
          {
            "field_pair": {
              "cad": "TimeofCall",
              "rms": "IncidentDate"
            },
            "tolerance": "same_day",
            "weight": 0.4
          },
          {
            "field_pair": {
              "cad": "TimeofCall",
              "rms": "IncidentTime"
            },
            "tolerance": "within_1_hour",
            "weight": 0.3
          },
          {
            "field_pair": {
              "cad": "FullAddress2",
              "rms": "FullAddress"
            },
            "similarity": "fuzzy_string_match",
            "threshold": 0.85,
            "weight": 0.3
          }
        ]
      },
      {
        "strategy_name": "officer_temporal_match",
        "description": "Match on officer plus date/time when primary key fails",
        "confidence_threshold": 0.80,
        "required_fields": {
          "cad": ["Officer", "TimeofCall"],
          "rms": ["OfficerOfRecord", "IncidentDate", "IncidentTime"]
        },
        "matching_rules": [
          {
            "field_pair": {
              "cad": "Officer",
              "rms": "OfficerOfRecord"
            },
            "similarity": "normalized_officer_match",
            "weight": 0.5
          },
          {
            "field_pair": {
              "cad": "TimeofCall",
              "rms": "IncidentDate"
            },
            "tolerance": "same_day",
            "weight": 0.3
          },
          {
            "field_pair": {
              "cad": "TimeofCall",
              "rms": "IncidentTime"
            },
            "tolerance": "within_2_hours",
            "weight": 0.2
          }
        ]
      },
      {
        "strategy_name": "address_zone_match",
        "description": "Match on address plus zone plus approximate date when primary key fails",
        "confidence_threshold": 0.75,
        "required_fields": {
          "cad": ["FullAddress2", "ZoneCalc"],
          "rms": ["FullAddress", "Zone"]
        },
        "optional_fields": {
          "cad": ["TimeofCall"],
          "rms": ["IncidentDate"]
        },
        "matching_rules": [
          {
            "field_pair": {
              "cad": "FullAddress2",
              "rms": "FullAddress"
            },
            "similarity": "fuzzy_string_match",
            "threshold": 0.90,
            "weight": 0.5
          },
          {
            "field_pair": {
              "cad": "ZoneCalc",
              "rms": "Zone"
            },
            "exact_match": true,
            "weight": 0.3
          },
          {
            "field_pair": {
              "cad": "TimeofCall",
              "rms": "IncidentDate"
            },
            "tolerance": "within_7_days",
            "weight": 0.2,
            "optional": true
          }
        ]
      }
    ]
  },
  "join_type": "left",
  "dedupe": {
    "rms_key": "Case Number",
    "policy": "keep_best",
    "sort_priority": [
      {
        "field": "Report Date",
        "direction": "desc"
      },
      {
        "field": "Report Time",
        "direction": "desc"
      }
    ],
    "tie_breaker": "first"
  },
  "mappings": [
    {
      "cad": {
        "internal_field_name": "ReportNumberNew",
        "source_field_name": "ReportNumberNew"
      },
      "rms": [
        {
          "internal_field_name": "CaseNumber",
          "source_field_name": "Case Number",
          "priority": 1
        }
      ],
      "notes": "Primary join key"
    },
    {
      "cad": {
        "internal_field_name": "Incident",
        "source_field_name": "Incident"
      },
      "rms": [
        {
          "internal_field_name": "IncidentType1",
          "source_field_name": "Incident Type_1",
          "priority": 1
        },
        {
          "internal_field_name": "IncidentType2",
          "source_field_name": "Incident Type_2",
          "priority": 2
        },
        {
          "internal_field_name": "IncidentType3",
          "source_field_name": "Incident Type_3",
          "priority": 3
        }
      ],
      "update_when": "cad_null_or_blank",
      "accept_when": "rms_not_null_or_blank",
      "notes": "Backfill order: Type_1 then Type_2 then Type_3",
      "audit_field": "Incident_source"
    },
    {
      "cad": {
        "internal_field_name": "FullAddress2",
        "source_field_name": "FullAddress2"
      },
      "rms": [
        {
          "internal_field_name": "FullAddress",
          "source_field_name": "FullAddress",
          "priority": 1
        }
      ],
      "update_when": "cad_null_or_blank",
      "accept_when": "rms_not_null_or_blank",
      "notes": "Address backfill",
      "audit_field": "FullAddress2_source"
    },
    {
      "cad": {
        "internal_field_name": "Grid",
        "source_field_name": "Grid"
      },
      "rms": [
        {
          "internal_field_name": "Grid",
          "source_field_name": "Grid",
          "priority": 1
        }
      ],
      "update_when": "cad_null_or_blank",
      "accept_when": "rms_not_null_or_blank",
      "notes": "Direct mapping",
      "audit_field": "Grid_source"
    },
    {
      "cad": {
        "internal_field_name": "PDZone",
        "source_field_name": "PDZone"
      },
      "rms": [
        {
          "internal_field_name": "Zone",
          "source_field_name": "Zone",
          "priority": 1
        }
      ],
      "update_when": "cad_null_or_blank",
      "accept_when": "rms_not_null_or_blank",
      "notes": "Zone backfill",
      "audit_field": "PDZone_source"
    },
    {
      "cad": {
        "internal_field_name": "Officer",
        "source_field_name": "Officer"
      },
      "rms": [
        {
          "internal_field_name": "OfficerOfRecord",
          "source_field_name": "Officer of Record",
          "priority": 1
        }
      ],
      "update_when": "cad_null_or_blank",
      "accept_when": "rms_not_null_or_blank",
      "notes": "Officer mapping",
      "audit_field": "Officer_source"
    }
  ],
  "audit": {
    "add_fields": [
      "merge_run_id",
      "merge_timestamp",
      "merge_join_key",
      "merge_match_flag",
      "merge_confidence_score",
      "merge_matching_strategy",
      "merge_rms_row_count_for_key"
    ],
    "source_fields": [
      "Incident_source",
      "FullAddress2_source",
      "Grid_source",
      "PDZone_source",
      "Officer_source"
    ]
  }
}
