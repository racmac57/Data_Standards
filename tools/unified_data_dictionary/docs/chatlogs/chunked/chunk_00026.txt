- Added support for multiple date formats: Excel serial numbers, actual dates, and text dates
  - Fixed month targeting to correctly identify previous month from current date

- **Arrest Script Path Resolution (2026-01-05)**
  - Updated `arrest_python_processor.py` to search recursively for source files
  - Changed from `glob("*.xlsx")` to `glob("**/*.xlsx")` to find files in subdirectories
  - Now correctly finds files in `05_EXPORTS/_Arrest/monthly_export/YYYY/` structure
  - Successfully processes December 2025 arrest data from `2025_12_LAWSOFT_ARREST.xlsx`

- **Culture Error in Type Conversion (2026-01-05)**
  - Removed problematic `Table.TransformColumnTypes()` calls that caused Culture errors
  - Implemented NO_TYPE_CONVERSION approach for `___Arrest_Categories` query
  - Power BI now auto-detects types from Excel source, avoiding regional format issues

- **Monthly Report Saving (2026-01-05)**
  - Added `Save-MonthlyReport` function to `run_all_etl.ps1`
  - Automatically saves monthly Power BI reports to structured directory: `Monthly Reports\{YEAR}\{MONTH_NUMBER}_{monthname}\`
  - Report filename format: `{YYYY}_{MM}_Monthly_FINAL_LAP.pbix`
  - Function runs after ETL execution completes

### Changed
- **Arrest Query Structure**
  - Moved all M code files to `m_code/` directory for better organization
  - Updated queries to use previous month logic (automatically targets December 2025 from January 2026)
  - Enhanced error handling for empty results (returns empty tables with correct schema instead of errors)

- **Documentation Organization**
  - Moved all `.md` and `.txt` files from root to `docs/` directory
  - Created dedicated `m_code/` directory for Power Query M code files
  - Improved project structure and navigability

### Added
- **Documentation**
  - `docs/ARREST_QUERIES_FIX_SUMMARY_2026_01_05.md` - Detailed summary of M code fixes
  - `docs/ARREST_SCRIPT_PATH_FIX.md` - Arrest script path resolution fix documentation
  - `docs/ARREST_SCRIPT_RUN_SUMMARY.md` - Script execution summary
  - `docs/DECEMBER_2025_ARREST_DATA_UPDATE.md` - December 2025 data processing guide
  - `docs/DIAGNOSTIC_INSTRUCTIONS.md` - Diagnostic query usage guide
  - `docs/DIAGNOSTIC_FILES_SUMMARY.md` - Summary of diagnostic M code files
  - `docs/REVIEW_Claude_Fixes_2026_01_05.md` - Review of Claude AI fixes

- **M Code Diagnostic Queries**
  - `m_code/___Top_5_Arrests_DIAGNOSTIC.m` - Diagnostic version of Top 5 query
  - `m_code/___Arrest_Date_Distribution.m` - Date distribution analysis query
  - `m_code/___Arrest_Raw_Data_Preview.m` - Raw data preview query
  - `m_code/___Top_5_Arrests_ALL_TIME.m` - All-time top 5 query (no date filter)

### Verified
- ✅ All M code queries compile without syntax errors
- ✅ December 2025 arrest data successfully processed
- ✅ PowerBI_Ready file created: `2025_12_Arrests_PowerBI_Ready.xlsx`
- ✅ Queries correctly filter to December 2025 data
- ✅ Date parsing handles Excel serial dates correctly
- ✅ No Culture errors in type conversion

---

## [1.1.0] - 2026-01-02

## [1.0.0] - 2025-12-11

### Added

#### Project Structure
- **Folder scaffolding**
  - `docs/` - Documentation files
  - `chatlogs/` - AI chat logs
  - `_DropExports/` - Optional staging folder
  - `logs/` - ETL execution logs (auto-created)

#### Documentation
- `SUMMARY.md` - Project summary and quick reference
- `CHANGELOG.md` - Version history (this file)
- `docs/PROJECT_STRUCTURE.md` - Directory structure guide
- `docs/FOLDER_STRUCTURE_CREATED.md` - Folder setup documentation
- `chatlogs/README.md` - Chat log guidelines

#### Scripts
- **Migration verification script** (`verify_migration.ps1`)
  - Automated 8-point verification checklist
  - Validates config paths, directory structure, junctions, and script references
  - Provides detailed status report

- **Overtime TimeOff helpers**
  - `scripts/overtime_timeoff_with_backfill.py` - Monthly wrapper (v10 + backfill + accrual history)
  - `scripts/restore_fixed_from_backfill.py` - Restore history into `FIXED_monthly_breakdown_*.csv`
    - Supports both WIDE exports (month columns) and LONG exports (`PeriodLabel` + `Sum of Value`)
    - Optional `--include-accruals` flag (off by default)
  - `scripts/compare_vcs_time_report_exports.py` - Compare refreshed exports vs baseline backfill exports

#### Git Repository
- Initialized local git repository
- Added `.gitignore` for logs and temporary files

### Changed

#### Configuration (`config\scripts.json`)
- Updated script filenames to match actual files:
  - Arrests: `arrest_python_processor.py`
  - Community Engagement: `deploy_production.py`
  - Overtime TimeOff: `overtime_timeoff_with_backfill.py` (wrapper around v10 + backfill)
  - Response Times: `response_time_diagnostic.py`
  - Summons: `main_orchestrator.py`
- Disabled scripts without Python files:
  - Policy Training Monthly
  - Arrest Data Source
  - NIBRS
- Updated `powerbi_drop_path` to OneDrive location
- Backup created: `config\scripts.json.bak`

#### Scripts
- `scripts\run_all_etl.ps1` - Updated next-step instructions with new PowerBI_Date path
- Removed all references to old `C:\Dev\PowerBI_Date` paths

- `scripts/overtime_timeoff_with_backfill.py`
  - Default backfill root updated to: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\Backfill`
  - Now backfills `analytics_output\monthly_breakdown.csv` for prior 12 months from the same backfill export (preserves current month from v10)

#### Documentation Organization
- Moved all markdown files (except README.md) to `docs/` folder
- Organized documentation by topic
- Created chatlogs directory for AI conversations

#### ETL Scripts
- Updated Response Times script backfill path:
  - Changed from: `C:\Dev\PowerBI_Date\Backfill\...`
  - Changed to: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\Backfill\...`

### Fixed
- All path references updated to reflect OneDrive migration
- Script file path handling verified for OneDrive paths with spaces
- Documentation consistency across all files
- ETL script filenames verified and corrected

- Overtime TimeOff historical “null/0” issue in Power BI visual
  - Restored legacy usage rows into `FIXED_monthly_breakdown_*.csv` from backfill exports
  - Populated accrual history by backfilling `analytics_output\monthly_breakdown.csv` (previously only current month existed)

### Infrastructure
- **Master_Automation Junction Created**
  - Location: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\Master_Automation`
  - Target: `C:\Users\carucci_r\OneDrive - City of Hackensack\Master_Automation`
  - Type: NTFS Junction (symlink)

### Verified
- ✅ Config file paths correct
- ✅ PowerBI_Date directory structure intact
- ✅ Master_Automation junction functional
- ✅ All script path references updated
- ✅ Documentation paths corrected
- ✅ Python executable accessible (Python 3.13.7)
- ✅ Drop folder accessible and writable
- ✅ All enabled script files exist and are accessible
- ✅ Dry run test passed successfully

---

## [0.9.0] - 2025-12-11 - Migration to OneDrive

### Added
- Migration verification script (`verify_migration.ps1`)
- Comprehensive migration documentation
- Verification guides and summaries

### Changed
- **PowerBI_Date Migration**
  - From: `C:\Dev\PowerBI_Date_Merged`
  - To: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date`
- Updated all path references in configuration and scripts
- Updated documentation with new paths

### Fixed
- All old path references removed
- Script logic verified for OneDrive paths

---

## [0.1.0] - 2025-12-09 - Initial Setup

### Added
- Initial Master_Automation workspace structure
- ETL orchestrator scripts (`run_all_etl.ps1`, `run_all_etl.bat`, `run_etl_script.ps1`)
- Configuration file (`config\scripts.json`)
- Basic documentation (`README.md`, `QUICK_START.md`)

### Features
- Sequential ETL script execution
- Error handling and logging
- Power BI output integration
- Selective script execution
- Status reporting

---

## Future Updates

### Planned
- [ ] ETL script filename verification and auto-detection
- [ ] Enhanced error reporting and recovery
- [ ] Performance monitoring and optimization
- [ ] Automated testing suite
- [ ] Integration with Power BI refresh scheduling
- [ ] Column reorder utility for backfill CSVs

### Under Consideration
- [ ] Web-based dashboard for ETL status
- [ ] Email notifications for failures
- [ ] Retry logic for transient errors
- [ ] Parallel script execution option
- [ ] Configuration UI
- [ ] Automated backfill column ordering

---

## Notes

- All paths are now OneDrive-synced for cloud backup and multi-device access
- Junction link allows seamless access to Master_Automation from PowerBI_Date directory
- Verification script should be run after any configuration changes
- Logs directory is auto-created on first ETL run
- Documentation organized in `docs/` folder for better structure
- Chat logs should be saved to `chatlogs/` folder with date prefix

---

**Maintained by:** R. A. Carucci  
**Last Updated:** 2026-01-02  
**Current Version:** 1.1.0


```

```markdown
# Changelog

All notable changes to the Master_Automation workspace will be documented in this file. The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html). ---

## [1.1.0] - 2026-01-02

### Added
- **Input Validation Feature**
  - Added `-ValidateInputs` parameter to `run_all_etl.ps1`
  - Automatic input validation when using `-DryRun` mode
  - Validates required export files exist before execution:
    - Summons: E-ticket exports in `05_EXPORTS\_Summons\E_Ticket\YYYY\YYYY_MM_eticket_export.csv`
    - Response Times: CAD monthly exports in `05_EXPORTS\_CAD\monthly_export\YYYY\YYYY_MM_Monthly_CAD.xlsx`
  - Shows helpful error messages with available files when expected files are missing

- **Badge Normalization Diagnostics**
  - `scripts/diagnose_badge_normalization.py` - Comprehensive badge number format validation
  - `scripts/find_missing_badge.py` - Quick script to find badges in e-ticket not in Assignment Master
  - `scripts/fix_assignment_master.py` - Fixes PADDED_BADGE_NUMBER format and adds missing entries
  - `scripts/verify_assignment_fix.py` - Verifies Assignment Master fixes

- **Script Archive**
  - Created `scripts/_archive/` directory for old/unused scripts
  - Archived `run_all_etl-PD_BCI_LTP.ps1` (old version superseded by main script)

### Changed
- **E-Ticket Export Path Structure**
  - Updated scripts to handle new e-ticket export naming convention:
    - Old: `YY_MM_e_ticketexport.csv` (e.g., `25_12_e_ticketexport.csv`)
    - New: `YYYY_MM_eticket_export.csv` in year subdirectories (e.g., `2025\2025_12_eticket_export.csv`)
  - Updated `diagnose_summons_missing_months.py` to search year subdirectories
  - Updated `count_patrol_m_p_from_eticket.py` help text

- **Response Times Validation**
  - Fixed filename pattern from `YYYY_MM_Monthly_CAD.xlsx.xlsx` to `YYYY_MM_Monthly_CAD.xlsx`
  - Updated validation to check correct year subdirectory structure

- **Assignment Master Fix**
  - Fixed `Assignment_Master_V2.csv` PADDED_BADGE_NUMBER column (ensured all values are 4-digit padded)
  - Added badge 1711 entry for PEO JOHN SQUILLACE (TRAFFIC BUREAU)

### Fixed
- E-ticket export path validation now correctly searches year subdirectories
- Response Times validation now uses correct filename format (single .xlsx extension)
- Badge 1711 missing from Assignment Master (now added with correct bureau assignment)
- All PADDED_BADGE_NUMBER values verified as correctly formatted (4-digit strings, no floats)

### Verified
- All e-ticket exports correctly formatted (4-digit Officer Id values)
- Assignment Master PADDED_BADGE_NUMBER column correctly formatted
- Badge 1711 now matches between e-ticket export and Assignment Master
- Input validation correctly identifies missing export files

## [Unreleased]

### Planned
- [ ] Enhanced error reporting and recovery
- [ ] Performance monitoring and optimization
- [ ] Automated testing suite
- [ ] Integration with Power BI refresh scheduling

---

## [1.2.0] - 2026-01-06

### Fixed
- **Arrest M Code Queries (2026-01-05)**
  - Fixed syntax errors in `___Top_5_Arrests_FIXED.m` and `___Arrest_Categories_FIXED.m`
  - Removed backslash line continuations (M Code doesn't support `\` for line continuation)
  - Fixed path string splitting issues in `Folder.Files` calls
  - Fixed lambda syntax errors (`(x) = >` → `(x) =>`)
  - Fixed missing operator spacing (`d<> null` → `d <> null`)
  - Fixed malformed `let...in` block structures

- **Arrest Date Parsing (2026-01-05)**
  - Enhanced `ToDate` function to handle Excel serial dates (45962, 45963, etc.) - Added support for multiple date formats: Excel serial numbers, actual dates, and text dates
  - Fixed month targeting to correctly identify previous month from current date

- **Arrest Script Path Resolution (2026-01-05)**
  - Updated `arrest_python_processor.py` to search recursively for source files
  - Changed from `glob("*.xlsx")` to `glob("**/*.xlsx")` to find files in subdirectories
  - Now correctly finds files in `05_EXPORTS/_Arrest/monthly_export/YYYY/` structure
  - Successfully processes December 2025 arrest data from `2025_12_LAWSOFT_ARREST.xlsx`

- **Culture Error in Type Conversion (2026-01-05)**
  - Removed problematic `Table.TransformColumnTypes()` calls that caused Culture errors
  - Implemented NO_TYPE_CONVERSION approach for `___Arrest_Categories` query
  - Power BI now auto-detects types from Excel source, avoiding regional format issues

- **Monthly Report Saving (2026-01-05)**
  - Added `Save-MonthlyReport` function to `run_all_etl.ps1`
  - Automatically saves monthly Power BI reports to structured directory: `Monthly Reports\{YEAR}\{MONTH_NUMBER}_{monthname}\`
  - Report filename format: `{YYYY}_{MM}_Monthly_FINAL_LAP.pbix`
  - Function runs after ETL execution completes

### Changed
- **Arrest Query Structure**
  - Moved all M code files to `m_code/` directory for better organization
  - Updated queries to use previous month logic (automatically targets December 2025 from January 2026)
  - Enhanced error handling for empty results (returns empty tables with correct schema instead of errors)

- **Documentation Organization**
  - Moved all `.md` and `.txt` files from root to `docs/` directory
  - Created dedicated `m_code/` directory for Power Query M code files
  - Improved project structure and navigability

### Added
- **Documentation**
  - `docs/ARREST_QUERIES_FIX_SUMMARY_2026_01_05.md` - Detailed summary of M code fixes
  - `docs/ARREST_SCRIPT_PATH_FIX.md` - Arrest script path resolution fix documentation
  - `docs/ARREST_SCRIPT_RUN_SUMMARY.md` - Script execution summary
  - `docs/DECEMBER_2025_ARREST_DATA_UPDATE.md` - December 2025 data processing guide
  - `docs/DIAGNOSTIC_INSTRUCTIONS.md` - Diagnostic query usage guide
  - `docs/DIAGNOSTIC_FILES_SUMMARY.md` - Summary of diagnostic M code files
  - `docs/REVIEW_Claude_Fixes_2026_01_05.md` - Review of Claude AI fixes

- **M Code Diagnostic Queries**
  - `m_code/___Top_5_Arrests_DIAGNOSTIC.m` - Diagnostic version of Top 5 query
  - `m_code/___Arrest_Date_Distribution.m` - Date distribution analysis query
  - `m_code/___Arrest_Raw_Data_Preview.m` - Raw data preview query
  - `m_code/___Top_5_Arrests_ALL_TIME.m` - All-time top 5 query (no date filter)

### Verified
- ✅ All M code queries compile without syntax errors
- ✅ December 2025 arrest data successfully processed
- ✅ PowerBI_Ready file created: `2025_12_Arrests_PowerBI_Ready.xlsx`
- ✅ Queries correctly filter to December 2025 data
- ✅ Date parsing handles Excel serial dates correctly
- ✅ No Culture errors in type conversion

---

## [1.1.0] - 2026-01-02

## [1.0.0] - 2025-12-11

### Added

#### Project Structure
- **Folder scaffolding**
  - `docs/` - Documentation files
  - `chatlogs/` - AI chat logs
  - `_DropExports/` - Optional staging folder
  - `logs/` - ETL execution logs (auto-created)

#### Documentation
- `SUMMARY.md` - Project summary and quick reference
- `CHANGELOG.md` - Version history (this file)
- `docs/PROJECT_STRUCTURE.md` - Directory structure guide
- `docs/FOLDER_STRUCTURE_CREATED.md` - Folder setup documentation
- `chatlogs/README.md` - Chat log guidelines

#### Scripts
- **Migration verification script** (`verify_migration.ps1`)
  - Automated 8-point verification checklist
  - Validates config paths, directory structure, junctions, and script references
  - Provides detailed status report

- **Overtime TimeOff helpers**
  - `scripts/overtime_timeoff_with_backfill.py` - Monthly wrapper (v10 + backfill + accrual history)
  - `scripts/restore_fixed_from_backfill.py` - Restore history into `FIXED_monthly_breakdown_*.csv`
    - Supports both WIDE exports (month columns) and LONG exports (`PeriodLabel` + `Sum of Value`)
    - Optional `--include-accruals` flag (off by default)
  - `scripts/compare_vcs_time_report_exports.py` - Compare refreshed exports vs baseline backfill exports

#### Git Repository
- Initialized local git repository
- Added `.gitignore` for logs and temporary files

### Changed

#### Configuration (`config\scripts.json`)
- Updated script filenames to match actual files:
  - Arrests: `arrest_python_processor.py`
  - Community Engagement: `deploy_production.py`
  - Overtime TimeOff: `overtime_timeoff_with_backfill.py` (wrapper around v10 + backfill)
  - Response Times: `response_time_diagnostic.py`
  - Summons: `main_orchestrator.py`
- Disabled scripts without Python files:
  - Policy Training Monthly
  - Arrest Data Source
  - NIBRS
- Updated `powerbi_drop_path` to OneDrive location
- Backup created: `config\scripts.json.bak`

#### Scripts
- `scripts\run_all_etl.ps1` - Updated next-step instructions with new PowerBI_Date path
- Removed all references to old `C:\Dev\PowerBI_Date` paths

- `scripts/overtime_timeoff_with_backfill.py`
  - Default backfill root updated to: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\Backfill`
  - Now backfills `analytics_output\monthly_breakdown.csv` for prior 12 months from the same backfill export (preserves current month from v10)

#### Documentation Organization
- Moved all markdown files (except README.md) to `docs/` folder
- Organized documentation by topic
- Created chatlogs directory for AI conversations

#### ETL Scripts
- Updated Response Times script backfill path:
  - Changed from: `C:\Dev\PowerBI_Date\Backfill\...`
  - Changed to: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\Backfill\...`

### Fixed
- All path references updated to reflect OneDrive migration
- Script file path handling verified for OneDrive paths with spaces
- Documentation consistency across all files
- ETL script filenames verified and corrected

- Overtime TimeOff historical “null/0” issue in Power BI visual
  - Restored legacy usage rows into `FIXED_monthly_breakdown_*.csv` from backfill exports
  - Populated accrual history by backfilling `analytics_output\monthly_breakdown.csv` (previously only current month existed)

### Infrastructure
- **Master_Automation Junction Created**
  - Location: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\Master_Automation`
  - Target: `C:\Users\carucci_r\OneDrive - City of Hackensack\Master_Automation`
  - Type: NTFS Junction (symlink)

### Verified
- ✅ Config file paths correct
- ✅ PowerBI_Date directory structure intact
- ✅ Master_Automation junction functional
- ✅ All script path references updated
- ✅ Documentation paths corrected
- ✅ Python executable accessible (Python 3.13.7)
- ✅ Drop folder accessible and writable
- ✅ All enabled script files exist and are accessible
- ✅ Dry run test passed successfully

---

## [0.9.0] - 2025-12-11 - Migration to OneDrive

### Added
- Migration verification script (`verify_migration.ps1`)
- Comprehensive migration documentation
- Verification guides and summaries

### Changed
- **PowerBI_Date Migration**
  - From: `C:\Dev\PowerBI_Date_Merged`
  - To: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date`
- Updated all path references in configuration and scripts
- Updated documentation with new paths

### Fixed
- All old path references removed
- Script logic verified for OneDrive paths

---

## [0.1.0] - 2025-12-09 - Initial Setup

### Added
- Initial Master_Automation workspace structure
- ETL orchestrator scripts (`run_all_etl.ps1`, `run_all_etl.bat`, `run_etl_script.ps1`)
- Configuration file (`config\scripts.json`)
- Basic documentation (`README.md`, `QUICK_START.md`)

### Features
- Sequential ETL script execution
- Error handling and logging
- Power BI output integration
- Selective script execution
- Status reporting

---

## Future Updates

### Planned
- [ ] ETL script filename verification and auto-detection
- [ ] Enhanced error reporting and recovery
- [ ] Performance monitoring and optimization
- [ ] Automated testing suite
- [ ] Integration with Power BI refresh scheduling
- [ ] Column reorder utility for backfill CSVs

### Under Consideration
- [ ] Web-based dashboard for ETL status
- [ ] Email notifications for failures
- [ ] Retry logic for transient errors
- [ ] Parallel script execution option
- [ ] Configuration UI
- [ ] Automated backfill column ordering

---

## Notes

- All paths are now OneDrive-synced for cloud backup and multi-device access
- Junction link allows seamless access to Master_Automation from PowerBI_Date directory
- Verification script should be run after any configuration changes
- Logs directory is auto-created on first ETL run
- Documentation organized in `docs/` folder for better structure
- Chat logs should be saved to `chatlogs/` folder with date prefix

---

**Maintained by:** R. A. Carucci  
**Last Updated:** 2026-01-06  
**Current Version:** 1.2.0


```


Updating README.md and SUMMARY.md with v1.2.0 changes:


```markdown
# Master ETL Automation

Centralized automation hub for running all Python ETL scripts that feed into Power BI reports. ## Overview

This directory orchestrates all Python data processing scripts from various workspaces and manages their output to the Power BI Date repository. ## Directory Structure

```
Master_Automation/
├── README.md                    # This file
├── CHANGELOG.md                 # Version history and updates
├── verify_migration.ps1         # Automated verification script
├── SUMMARY.md                   # Project summary / quick reference
├── config/
│   ├── scripts.json            # Configuration for all ETL scripts
│   └── scripts.json.bak        # Backup of previous config
├── scripts/
│   ├── run_all_etl.ps1         # PowerShell orchestrator (recommended)
│   ├── run_all_etl.bat         # Batch file orchestrator
│   ├── run_etl_script.ps1      # Helper script to run individual scripts
│   ├── _archive/                # Archived old/unused scripts
│   ├── overtime_timeoff_with_backfill.py     # Overtime/TimeOff monthly wrapper (v10 + backfill)
│   ├── restore_fixed_from_backfill.py        # Restores history into FIXED_monthly_breakdown
│   └── compare_vcs_time_report_exports.py    # Diff tool for visual exports/backfill validation
│   ├── compare_policy_training_delivery.py   # Policy Training: visual vs ETL/backfill diff
│   ├── compare_summons_deptwide.py           # Summons Dept-Wide: visual vs ETL/backfill diff
│   ├── diagnose_summons_blank_bureau.py      # Summons: find blank WG2 (Bureau) rows
│   └── run_summons_with_overrides.py         # Summons: run with injected badge overrides (e.g., 1711)
├── docs/                        # Project documentation (migration, verification, guides)
└── logs/
    └── .gitkeep                # ETL execution logs go here (auto-created)
```

## Quick Start

### Run All ETL Scripts

**PowerShell (Recommended):**
```powershell
cd C:\Users\carucci_r\OneDrive - City of Hackensack\Master_Automation
.\scripts\run_all_etl.ps1
```

**Batch File:**
```batch
cd "C:\Users\carucci_r\OneDrive - City of Hackensack\Master_Automation"
scripts\run_all_etl.bat
```

### Run Specific Script

```powershell
.\scripts\run_etl_script.ps1 -ScriptName "Arrests"
```

### Preview Execution (Dry Run with Validation)

Preview what would execute and validate required input files:

```powershell
.\scripts\run_all_etl.ps1 -DryRun
```

This will:
- Show which scripts would execute
- Validate that required export files exist (e-ticket exports, CAD exports, etc.) - Report any missing files before execution

## Configuration

Edit `config/scripts.json` to add, remove, or modify ETL scripts:

```json
{
  "scripts": [
    {
      "name": "Arrests",
      "path": "C:\\Users\\carucci_r\\OneDrive - City of Hackensack\\02_ETL_Scripts\\Arrests",
      "script": "arrest_python_processor.py",
      "enabled": true,
      "output_to_powerbi": true,
      "order": 1
    },
    {
      "name": "Community Engagement",
      "path": "C:\\Users\\carucci_r\\OneDrive - City of Hackensack\\02_ETL_Scripts\\Community_Engagment",
      "script": "deploy_production.py",
      "enabled": true,
      "output_to_powerbi": true,
      "order": 2
    },
    {
      "name": "Overtime TimeOff",
      "path": "C:\\Users\\carucci_r\\OneDrive - City of Hackensack\\Master_Automation\\scripts",
      "script": "overtime_timeoff_with_backfill.py",
      "enabled": true,
      "output_to_powerbi": false,
      "order": 3
    }
  ]
}
```

## Features

- **Sequential Execution:** Runs scripts in specified order
- **Error Handling:** Continues on errors, logs failures
- **Logging:** Detailed logs for each script execution
- **Power BI Integration:** Automatically copies outputs to Power BI drop folder
- **Selective Execution:** Run all, or specific scripts
- **Status Reporting:** Summary of what succeeded/failed
- **Input Validation:** Validates required export files exist before execution (`-ValidateInputs` or automatic with `-DryRun`)
- **Dry Run Mode:** Preview execution without running scripts (`-DryRun`)

## Workflow

1. **Configure:** Edit `config/scripts.json` with your script paths
2. **Run:** Execute `run_all_etl.ps1` or `run_all_etl.bat`
3. **Process:** Scripts execute in order, outputs logged
4. **Integrate:** Successful outputs copied to Power BI Date repository
5. **Review:** Check logs for any failures or warnings

## Output Integration

All successful outputs are automatically:
1. Validated (CSV format, proper structure)
2. Copied to `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\_DropExports\`
3. Ready for `organize_backfill_exports.ps1` processing

## Logging

Logs are saved to:
- `logs/YYYY-MM-DD_HH-MM-SS_ETL_Run.log` - Overall execution log
- `logs/YYYY-MM-DD_HH-MM-SS_[ScriptName].log` - Individual script logs

## Error Handling

- Scripts run independently (failure of one doesn't stop others)
- Errors logged with details
- Summary report shows success/failure status
- Failed scripts can be re-run individually

## Recent Updates

### 2026-01-06: v1.2.0 - Arrest Query Fixes & Path Resolution ✅

**Arrest M Code Queries Fixed:**
- Fixed syntax errors in `___Top_5_Arrests` and `___Arrest_Categories` queries
- Removed backslash line continuations (M Code doesn't support `\`)
- Enhanced date parsing to handle Excel serial dates (45962, 45963, etc.) - Fixed Culture errors by removing problematic type conversions
- All queries now compile and execute successfully

**Arrest Script Path Fix:**
- Updated `arrest_python_processor.py` to search recursively for source files
- Changed from `glob("*.xlsx")` to `glob("**/*.xlsx")` to find files in subdirectories
- Now correctly processes December 2025 data from `monthly_export/2025/` structure

**Monthly Report Automation:**
- Added automatic monthly report saving to `run_all_etl.ps1`
- Reports saved to structured directory: `Monthly Reports\{YEAR}\{MONTH_NUMBER}_{monthname}\`
- Filename format: `{YYYY}_{MM}_Monthly_FINAL_LAP.pbix`

**Documentation:**
- Organized M code files into `m_code/` directory
- Created comprehensive fix documentation and diagnostic guides
- See [CHANGELOG.md](CHANGELOG.md#120---2026-01-06) for full details

### 2025-12-12: Summons Troubleshooting & Fixes ✅
- **Comprehensive diagnostic and troubleshooting completed**
  - Created troubleshooting guide: `claude_code_summons.md`
  - Diagnosed and resolved all Power BI issues (WG2, missing columns, DAX measures)
  - Verified M Code queries working correctly
  - Fixed DAX measure: `___Total Tickets = COUNTROWS('___Summons')`
  - Created diagnostic scripts for ongoing maintenance
- **Status:** All issues resolved - system healthy and working correctly
- **Action Required:** Update DAX measure in Power BI Desktop (2 minutes)

### 2025-12-11: Migration to OneDrive Complete ✅

### Migration to OneDrive Complete ✅
- **PowerBI_Date** moved from `C:\Dev\PowerBI_Date_Merged` to OneDrive location
- All path references updated in configuration and scripts
- Master_Automation junction created for seamless integration
- Verification scripts and documentation added

### New Files Added
- `verify_migration.ps1` - Automated verification script
- `CHANGELOG.md` - Version history
- Documentation moved under `docs/` (migration + verification + guides)

### Configuration Updates
- `powerbi_drop_path` updated to: `C:\Users\carucci_r\OneDrive - City of Hackensack\PowerBI_Date\_DropExports`
- All script paths verified and updated
- Documentation paths corrected

### Verification
Run `.\verify_migration.ps1` to verify all paths and configurations are correct.